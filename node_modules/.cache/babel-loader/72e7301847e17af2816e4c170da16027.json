{"ast":null,"code":"import _objectWithoutProperties from\"/Users/macbook/Documents/GitHub/React 3/billing-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";import _objectSpread from\"/Users/macbook/Documents/GitHub/React 3/billing-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/Users/macbook/Documents/GitHub/React 3/billing-app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";var _excluded=[\"createdAt\",\"name\",\"price\",\"updatedAt\",\"user\",\"__v\"],_excluded2=[\"_id\"];import{React,useState,useEffect}from\"react\";import{useDispatch,useSelector}from\"react-redux\";import{asyncGetCustomers}from\"../../actions/customerActions\";import{asyncGetProducts}from\"../../actions/ProductActions\";import BillModal from'./BillModal';import'../../CSS/billModal.css';import{asyncAddBill}from\"../../actions/billActions\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var AddBill=function AddBill(){var dispatch=useDispatch();useEffect(function(){dispatch(asyncGetCustomers());},[dispatch]);useEffect(function(){dispatch(asyncGetProducts());},[dispatch]);var customerData=useSelector(function(state){return state.customers.data;});var productData=useSelector(function(state){return state.products.data;});var date=new Date();var _useState=useState({customerEmail:'',productName:'',billDate:date.toISOString().substring(0,10)}),_useState2=_slicedToArray(_useState,2),form=_useState2[0],setForm=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),modal=_useState4[0],setModal=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),filteredCustomerData=_useState6[0],setFilteredCustomerData=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),filteredProductData=_useState8[0],setFilteredProductData=_useState8[1];var _useState9=useState({}),_useState10=_slicedToArray(_useState9,2),customerInfo=_useState10[0],setCustomerInfo=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),cartItems=_useState12[0],setCartItems=_useState12[1];var handleChange=function handleChange(e){if(e.target.name===\"customerEmail\"){setForm(_objectSpread(_objectSpread({},form),{},{customerEmail:e.target.value}));var result=customerData.filter(function(ele){return ele.email.toLowerCase().includes(e.target.value);});if(e.target.value===''){setFilteredCustomerData([]);}else{setFilteredCustomerData(result);}}else if(e.target.name===\"productName\"){setForm(_objectSpread(_objectSpread({},form),{},{productName:e.target.value}));var _result=productData.filter(function(ele){return ele.name.toLowerCase().includes(e.target.value);});if(e.target.value===''){setFilteredProductData([]);}else{setFilteredProductData(_result);}}else if(e.target.name===\"billDate\"){setForm(_objectSpread(_objectSpread({},form),{},{billDate:e.target.value}));}};var handleAddBill=function handleAddBill(){setModal(!modal);};var hideModal=function hideModal(){setModal(!modal);};var handleCustomerEmail=function handleCustomerEmail(id){var result=filteredCustomerData.find(function(ele){return ele._id===id;});setCustomerInfo(result);setForm(_objectSpread(_objectSpread({},form),{},{customerEmail:''}));setFilteredCustomerData([]);};var handleProductName=function handleProductName(id){var checkCart=cartItems.filter(function(ele){return ele._id===id;});if(checkCart.length>0){alert('Item is already present in cart, increasing quantity');incQuantity(id);}else{var result=filteredProductData.find(function(ele){return ele._id===id;});result.quantity=1;setCartItems(cartItems.concat(result));setForm(_objectSpread(_objectSpread({},form),{},{productName:''}));setFilteredProductData([]);}};var decQuantity=function decQuantity(id){var result=cartItems.map(function(ele){if(ele._id===id){return _objectSpread(_objectSpread({},ele),{},{quantity:ele.quantity-1});}else{return _objectSpread({},ele);}});setCartItems(result);};var incQuantity=function incQuantity(id){var result=cartItems.map(function(ele){if(ele._id===id){return _objectSpread(_objectSpread({},ele),{},{quantity:ele.quantity+1});}else{return _objectSpread({},ele);}});setCartItems(result);};var removeItem=function removeItem(id){var result=cartItems.filter(function(ele){return ele._id!==id;});var response=window.confirm('Remove Item?');response&&setCartItems(result);};var totalBill=function totalBill(){var total=0;for(var i=0;i<cartItems.length;i++){total+=cartItems[i].quantity*cartItems[i].price;}return total;};var handleSubmit=function handleSubmit(e){e.preventDefault();var result=cartItems.map(function(_ref){var createdAt=_ref.createdAt,name=_ref.name,price=_ref.price,updatedAt=_ref.updatedAt,user=_ref.user,__v=_ref.__v,rest=_objectWithoutProperties(_ref,_excluded);return _objectSpread(_objectSpread({},rest),{},{product:rest._id});});var finalArr=result.map(function(_ref2){var _id=_ref2._id,rest=_objectWithoutProperties(_ref2,_excluded2);return rest;});var formData={date:form.billDate,customer:customerInfo._id,lineItems:finalArr};dispatch(asyncAddBill(formData));setModal(!modal);};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"button\",{onClick:handleAddBill,children:\"Add Bill\"}),/*#__PURE__*/_jsx(\"p\",{}),/*#__PURE__*/_jsx(BillModal,{modal:modal,hideModal:hideModal,children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Bill Date\"}),\" \",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",name:\"billDate\",value:form.billDate,onChange:handleChange}),\" \",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"p\",{}),/*#__PURE__*/_jsx(\"label\",{children:\"Customer Email\"}),\" \",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"customerEmail\",value:form.customerEmail,onChange:handleChange}),\" \",/*#__PURE__*/_jsx(\"br\",{}),filteredCustomerData.length>0&&/*#__PURE__*/_jsx(\"div\",{children:filteredCustomerData.map(function(customer,i){return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"p\",{onClick:function onClick(){handleCustomerEmail(customer._id);},children:customer.email})},i);})}),/*#__PURE__*/_jsx(\"p\",{}),/*#__PURE__*/_jsx(\"label\",{children:\"Product Name\"}),\" \",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"productName\",value:form.productName,onChange:handleChange}),filteredProductData.length>0&&/*#__PURE__*/_jsx(\"div\",{children:filteredProductData.map(function(product,i){return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"p\",{onClick:function onClick(){handleProductName(product._id);},children:[product.name,\" \\u20B9\",product.price]})},i);})}),/*#__PURE__*/_jsx(\"p\",{}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Customer Details\"}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"b\",{children:customerInfo.name}),\" \",customerInfo.email]}),Object.keys(customerInfo).length>0&&/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:function onClick(){setCustomerInfo({});},children:\"Remove\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"mb-0 pb-2\",children:\"Items to be billed\"}),/*#__PURE__*/_jsxs(\"table\",{className:\"table border-top border-2 border-dark align-middle\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Sno.\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Name\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Price\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Quantity\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Total\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Actions\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:cartItems.map(function(item,i){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:i+1}),/*#__PURE__*/_jsx(\"td\",{children:item.name}),/*#__PURE__*/_jsx(\"td\",{children:item.price}),/*#__PURE__*/_jsxs(\"td\",{children:[/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){decQuantity(item._id);},disabled:item.quantity===1,children:\" - \"}),item.quantity,/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){incQuantity(item._id);},children:\" + \"})]}),/*#__PURE__*/_jsx(\"td\",{children:item.price*item.quantity}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-danger\",onClick:function onClick(){removeItem(item._id);},children:\"Remove\"})})]},item._id);})})]})]}),/*#__PURE__*/_jsxs(\"h3\",{children:[\"Total - \\u20B9\",totalBill()]}),/*#__PURE__*/_jsx(\"input\",{onClick:handleSubmit,type:\"submit\",value:\"SUBMIT\"}),/*#__PURE__*/_jsx(\"p\",{})]})})]});};export default AddBill;","map":{"version":3,"sources":["/Users/macbook/Documents/GitHub/React 3/billing-app/src/Components/Bills/AddBill.js"],"names":["React","useState","useEffect","useDispatch","useSelector","asyncGetCustomers","asyncGetProducts","BillModal","asyncAddBill","AddBill","dispatch","customerData","state","customers","data","productData","products","date","Date","customerEmail","productName","billDate","toISOString","substring","form","setForm","modal","setModal","filteredCustomerData","setFilteredCustomerData","filteredProductData","setFilteredProductData","customerInfo","setCustomerInfo","cartItems","setCartItems","handleChange","e","target","name","value","result","filter","ele","email","toLowerCase","includes","handleAddBill","hideModal","handleCustomerEmail","id","find","_id","handleProductName","checkCart","length","alert","incQuantity","quantity","concat","decQuantity","map","removeItem","response","window","confirm","totalBill","total","i","price","handleSubmit","preventDefault","createdAt","updatedAt","user","__v","rest","product","finalArr","formData","customer","lineItems","Object","keys","item"],"mappings":"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","sourcesContent":["import {React, useState, useEffect} from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { asyncGetCustomers } from \"../../actions/customerActions\";\nimport { asyncGetProducts } from \"../../actions/ProductActions\";\nimport BillModal from './BillModal'\nimport '../../CSS/billModal.css'\nimport { asyncAddBill } from \"../../actions/billActions\";\n\nconst AddBill = () => {\n\n    const dispatch = useDispatch()\n\n    useEffect(()=>{\n        dispatch(asyncGetCustomers())\n    },[dispatch])\n    useEffect(()=>{\n        dispatch(asyncGetProducts())\n    },[dispatch])\n\n    const customerData = useSelector(state=>state.customers.data)\n    const productData = useSelector(state=>state.products.data)\n\n    const date = new Date()\n    const [form, setForm] = useState({customerEmail:'', productName:'', billDate:(date.toISOString().substring(0, 10))})\n    const [modal, setModal] = useState(false)\n    const [filteredCustomerData, setFilteredCustomerData] = useState([])\n    const [filteredProductData, setFilteredProductData] = useState([])\n    const [customerInfo, setCustomerInfo] = useState({})\n    const [cartItems, setCartItems] = useState([])\n\n    const handleChange = (e) =>{\n        if (e.target.name===\"customerEmail\"){\n            setForm({...form, customerEmail:e.target.value})\n            const result = customerData.filter(ele=>ele.email.toLowerCase().includes(e.target.value))\n            if (e.target.value === ''){\n                setFilteredCustomerData([])\n            } else {\n                setFilteredCustomerData(result)\n            }\n        } else if (e.target.name===\"productName\"){\n            setForm({...form, productName:e.target.value})\n            const result = productData.filter(ele=>ele.name.toLowerCase().includes(e.target.value))\n            if (e.target.value === ''){\n                setFilteredProductData([])\n            } else {\n                setFilteredProductData(result)\n            }\n        } else if (e.target.name===\"billDate\") {\n            setForm({...form, billDate:e.target.value})\n        }\n\n    }\n\n    const handleAddBill = () => {\n        setModal(!modal)\n    }\n\n    const hideModal = () => {\n        setModal(!modal)\n    }\n\n    const handleCustomerEmail = (id) => {\n        const result = filteredCustomerData.find(ele=>ele._id===id)\n        setCustomerInfo(result)\n        setForm({...form, customerEmail:''})\n        setFilteredCustomerData([])\n    }\n\n    const handleProductName = (id) => {\n        const checkCart = cartItems.filter((ele) => {\n            return ele._id === id\n        })\n        if (checkCart.length>0){\n            alert('Item is already present in cart, increasing quantity')\n            incQuantity(id)\n        } else {\n            const result = filteredProductData.find(ele=>ele._id===id)\n            result.quantity = 1\n            setCartItems(cartItems.concat(result))\n            setForm({...form, productName:''})\n            setFilteredProductData([])\n        }\n    }\n\n    const decQuantity = (id) => {\n        const result = cartItems.map((ele) => {\n            if (ele._id === id) {\n                return {...ele, quantity: ele.quantity - 1}\n            }\n            else {\n                return {...ele}\n            }\n        })\n        setCartItems(result)\n    }\n\n    const incQuantity = (id) => {\n        const result = cartItems.map((ele) => {\n            if (ele._id === id) {\n                return {...ele, quantity: ele.quantity + 1}\n            }\n            else {\n                return {...ele}\n            }\n        })\n        setCartItems(result)\n    }\n\n    const removeItem = (id) => {\n        const result = cartItems.filter((ele) => {\n            return ele._id !== id\n        })\n        const response = window.confirm('Remove Item?')\n        response && setCartItems(result)\n    }\n\n    const totalBill = () => {\n        let total = 0\n        for (let i = 0; i < cartItems.length; i++) {\n            total += (cartItems[i].quantity * cartItems[i].price)\n        }\n        return total\n    }\n\n    const handleSubmit = (e) => {\n        e.preventDefault()\n        const result = cartItems.map(({createdAt, name, price, updatedAt, user, __v, ...rest})=>{\n            return {...rest, product:rest._id}\n        })\n        const finalArr = result.map(({_id,...rest})=>rest)\n        const formData = {\n            date: form.billDate,\n            customer: customerInfo._id,\n            lineItems: finalArr\n        }\n        dispatch(asyncAddBill(formData))\n        setModal(!modal)\n    }\n\n    return (\n        <div>\n            <button onClick={handleAddBill}>Add Bill</button>\n            <p></p>\n            <BillModal modal={modal} hideModal={hideModal}>\n            <div>\n                <label>Bill Date</label> <br/>\n                <input\n                type=\"date\"\n                name=\"billDate\"\n                value={form.billDate}\n                onChange={handleChange}\n                /> <br/>\n                <p></p>\n                <label>Customer Email</label> <br/>\n                <input\n                type=\"text\"\n                name=\"customerEmail\"\n                value={form.customerEmail}\n                onChange={handleChange}\n                /> <br/>\n                { filteredCustomerData.length > 0 &&\n                <div>{filteredCustomerData.map((customer,i)=>{\n                    return (\n                        <div key={i}>\n                        <p onClick={()=>{handleCustomerEmail(customer._id)}}>{customer.email}</p>\n                        </div>\n                    )\n                })}\n                </div>}\n                <p></p>\n                <label>Product Name</label> <br/>\n                <input\n                type=\"text\"\n                name=\"productName\"\n                value={form.productName}\n                onChange={handleChange}\n                /> \n                { filteredProductData.length > 0 &&\n                <div>{filteredProductData.map((product,i)=>{\n                    return (\n                        <div key={i}>\n                        <p onClick={()=>{handleProductName(product._id)}}>{product.name} ₹{product.price}</p>\n                        </div>\n                    )\n                })}</div>\n                }\n                <p></p>\n                {<div>\n                    <h3>Customer Details</h3>\n                    <p><b>{customerInfo.name}</b> {customerInfo.email}</p>\n                    {Object.keys(customerInfo).length>0 && <button type='button' onClick={()=>{setCustomerInfo({})}}>Remove</button>}\n                </div>\n                }\n                <div>\n                    <h3 className=\"mb-0 pb-2\">Items to be billed</h3>\n\n                    <table className='table border-top border-2 border-dark align-middle'>\n                        <thead>\n                            <tr>\n                                <th>Sno.</th>\n                                <th>Name</th>\n                                <th>Price</th>\n                                <th>Quantity</th>\n                                <th>Total</th>\n                                <th>Actions</th>\n                            </tr>\n\n                        </thead>\n                        <tbody>\n                            {cartItems.map((item, i) => {\n                                return (\n                                    <tr key={item._id}>\n                                        <td>\n                                            {i + 1}\n                                        </td>\n                                        <td>\n                                            {item.name}\n                                        </td>\n                                        <td>\n                                            {item.price}\n                                        </td>\n                                        <td><button onClick={() => {decQuantity(item._id)}} disabled={item.quantity === 1}> - </button>{item.quantity}<button onClick={() => {incQuantity(item._id)}}> + </button></td>\n                                        <td>{item.price * item.quantity}</td>\n                                        <td>\n                                            <button className=\"btn btn-danger\" onClick={() => { removeItem(item._id) }} >Remove</button>\n                                        </td>\n                                    </tr>\n                                )\n                            })}\n                        </tbody>\n                    </table>\n\n                </div>\n                <h3>Total - ₹{totalBill()}</h3>\n                <input\n                onClick={handleSubmit}\n                type=\"submit\"\n                value=\"SUBMIT\"\n                />\n                <p></p>\n            </div>\n            </BillModal>\n        </div>\n    )\n}\n\nexport default AddBill"]},"metadata":{},"sourceType":"module"}